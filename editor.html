<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title>Dashboard Configurator</title>
  <script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/3.12.0/codemirror.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/2.36.0/javascript.js"></script>
  <script src="lib/inlet.min.js"></script>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/3.12.0/codemirror.css">
  <link rel="stylesheet" href="lib/inlet.css">
  <script src='requireConfig.js'></script>
  <script src='//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.5/require.min.js'></script>
  <style>
    html, body {
      margin: 0;
      height: 100%;
    }
    #editorContainer {
      position: fixed;
      top: 0%;
      left: 0%;
      width: 40%;
      height: 100%;
    }
    #dashboard {
      position: fixed;
      top: 0%;
      left: 40%;
      width: 60%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="editorContainer">
    <textarea id="editor"></textarea>
  </div>
  <div id="dashboard"></iframe>
  <script>
    var invalidJSONConfig = {
      "dashboardDivId": "dashboard",
      "visualizations": {
        "vis": { 
          "color": "red",
          "text": "Invalid JSON",
          "fontSize": "30pt"
        }
      },
      "layout": {
        "orientation": "vertical",
        "children": [ { "name": "vis", "size": 1 } ]
      },
      "visDivCSS": { "border-style": "solid", "border-width": "2px" }
    }
    var codeMirror = CodeMirror.fromTextArea(editor);
    Inlet(codeMirror);
    codeMirror.setOption('mode', 'javascript');
    codeMirror.setSize('100%', '100%');
    require.config({ baseUrl: 'js' });
    require(['d3', 'main'], function(d3, main){
      d3.text('dashboardConfig.json', function(configJSON){
        codeMirror.setOption('value', configJSON);
        var config = JSON.parse(configJSON);
        codeMirror.on('change', function(){
          var json = codeMirror.getValue();
          try{
            main.dashboard.setConfig(JSON.parse(json));
          }
          catch(e){
            main.dashboard.setConfig(invalidJSONConfig);
          }
        });
      });
    });
  </script>
</body>
</html>
